
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
body{
    line-height:1.6;
    font-size:18px;
    color:#eee;
    background-color:#222;
}
a:link {
    color: #3352e1;
}
a:visited {
    color: #533354
}
.border-bottom {
    border-bottom: solid;
}
.monospace {
    font-family: monospace;
}
</style>
</head>
<body>
<label id="sort-button-label" for="sort-button">Loading ...</label>
<button id="sort-button">Loading ...</button>
<div id="the-list"></div>
</body>
<script>
(async () => {
    const sortButtonLabel = document.getElementById("sort-button-label")
    const sortButton = document.getElementById("sort-button")
    const listParent = document.getElementById("the-list")

    const username = "Ryan1729"

    const repos = [];
    const perPage = 100 // Github's maximum is 100
    let page = 1

    while (true) {
        const response = await fetch(`https://api.github.com/users/${username}/repos?per_page=${perPage}&page=${page}`);

        try {
            const loadedRepos = await response.json();

            for (repo of loadedRepos) {
                repos.push(repo)
            }

            if (loadedRepos.length < perPage) {
                break
            }

            page += 1
        } catch (error) {
            listParent.innerText = response.status + (response.statusText ? " " + response.statusText: "") + ": " + error.message

            return
        }
    }


    const ALPHA = "Alphabetical By Name"
    const CREATED_AT_DESC = "Create Date (Desc)"
    const CREATED_AT_ASC = "Create Date (Asc)"
    const UPDATED_AT_DESC = "Update Date (Desc)"
    const UPDATED_AT_ASC = "Update Date (Asc)"

    const MODES = [
        ALPHA,
        CREATED_AT_DESC,
        CREATED_AT_ASC,
        UPDATED_AT_DESC,
        UPDATED_AT_ASC,
    ]
    const DEFAULT = ALPHA

    let globalModeIndex = 0

    const nextModeIndex = (modeIndex) => (modeIndex + 1) % MODES.length

    const render = (modeIndex) => {
        const mode = MODES[modeIndex]
        const nextMode = MODES[nextModeIndex(modeIndex)]

        switch (mode) {
            default:
            case ALPHA:
                repos.sort((a, b) => a.name.localeCompare(b.name))
            break;
            case CREATED_AT_DESC:
                // reversed for descending order
                repos.sort((a, b) => b.created_at.localeCompare(a.created_at))
            break;
            case CREATED_AT_ASC:
                repos.sort((a, b) => a.created_at.localeCompare(b.created_at))
            break;
            case UPDATED_AT_DESC:
                // reversed for descending order
                repos.sort((a, b) => b.updated_at.localeCompare(a.updated_at))
            break;
            case UPDATED_AT_ASC:
                repos.sort((a, b) => a.updated_at.localeCompare(b.updated_at))
            break;
        }

        listParent.textContent = ""

        for (repo of repos) {
            if (
                repo.fork
                || repo.owner.login !== username
                || repo.archived
                || repo.disabled
            ) {
                continue
            }

            const article = document.createElement("article")

            const filtered = Object.keys(repo)
              .filter(key => !key.startsWith("has") && !key.endsWith("url") && !key.endsWith("count") && !["archived", "disabled", "id", "node_id", "full_name", "private", "owner", "name", "description", "fork", "web_commit_signoff_required", "allow_forking", "is_template", "visibility", "forks", "open_issues", "watchers", "default_branch"].includes(key))
              .reduce((obj, key) => {
                obj[key] = repo[key];
                return obj;
              }, {});

            sortButtonLabel.innerText = mode
            sortButton.innerText = nextMode

            article.innerHTML = `
                <h3>${repo.homepage ? `<a href="${repo.homepage}">${repo.name}</a>` : repo.name}</h3>

                <a href="${repo.html_url}">repo</a></h3>

                <p>${repo.description || ""}</p>

                <p class="monospace">${JSON.stringify(filtered)}</p>
            `
            article.className = "border-bottom"

            listParent.appendChild(article)
        }
    }

    sortButton.onclick = () => {
        globalModeIndex = nextModeIndex(globalModeIndex)
        render(globalModeIndex)
    }

    render(globalModeIndex)
})()
</script>
</html>
